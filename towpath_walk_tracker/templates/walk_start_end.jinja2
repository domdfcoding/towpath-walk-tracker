{# djlint:off #}
{% macro script(this, kwargs) %}
    // var {{this.get_name()}} = L.popup();

    function placeMarkerOnClick(e) {
        if (!sidebar_add_walk_pane.classList.contains("active")) {
            return;
        }

        let closest_latlng = snapCoordToLine(e.latlng.lat, e.latlng.lng);
        addMarker(closest_latlng.lng, closest_latlng.lat);
        addPoint(closest_latlng.lng, closest_latlng.lat)

        refreshWalkPreview(false);

    }

    {# sidebar.on('closing', function(e) {
        if (sidebar_add_walk_pane.classList.contains("active")) clearMarkers();
    }); #}

    {{this._parent.get_name()}}.on('click', placeMarkerOnClick);
{% endmacro %}
{# djlint:on #}
