{# djlint:off #}
{% macro script(this, kwargs) %}
    // var {{this.get_name()}} = L.popup();

    function placeMarkerOnClick(e) {
        if (!sidebar_add_walk_pane.classList.contains("active")) {
            return;
        }

        let closest_latlng = walkPreview.snapCoordToLine(e.latlng.lat, e.latlng.lng);
        const distance = L.GeometryUtil.distance(map_canal_towpath_walking, e.latlng, closest_latlng);
		console.log('Distance from click to point is', distance);
		if (distance <= 20) {
            walkPreview.addMarker(closest_latlng.lat, closest_latlng.lng);
            walkForm.addPoint(closest_latlng.lat, closest_latlng.lng)

            walkPreview.refresh(false);
		}

    }

    {# sidebar.on('closing', function(e) {
        if (sidebar_add_walk_pane.classList.contains("active")) clearMarkers();
    }); #}

    {{this._parent.get_name()}}.on('click', placeMarkerOnClick);
{% endmacro %}
{# djlint:on #}
